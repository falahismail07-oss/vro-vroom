name: Build Lovable and Package WordPress Theme

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install dependencies
        run: npm ci

      - name: Build (Vite)
        run: npm run build

      - name: Create WordPress theme and copy dist
        shell: bash
        run: |
          set -e
          THEME="creativestudio_dynamic"
          mkdir -p "$THEME"

          cat > "$THEME/style.css" <<'EOF'
/*
Theme Name: Creativestudio Dynamic
Theme URI: https://preview--vro-auto-connect.lovable.app/
Author: You
Description: WordPress theme generated from a Lovable (Vite/React) project.
Version: 1.0.0
Requires at least: 6.0
Tested up to: 6.6
Requires PHP: 7.4
License: GPL-2.0-or-later
License URI: http://www.gnu.org/licenses/gpl-2.0.html
Text Domain: creativestudio-dynamic
*/
EOF

          cat > "$THEME/functions.php" <<'EOF'
<?php
add_action('after_setup_theme', function () {
  add_theme_support('title-tag');
  add_theme_support('post-thumbnails');
  add_theme_support('html5', ['style','script','gallery','caption','search-form']);
  add_theme_support('responsive-embeds');
  register_nav_menus(['primary' => __('Primary Menu','creativestudio-dynamic')]);
});
function csd_enqueue_dir($url, $path) {
  if (!is_dir($path)) return;
  foreach (glob($path.'/*.css') as $css) {
    $h='csd-'.md5($css); wp_enqueue_style($h, $url.'/'.basename($css), [], filemtime($css));
  }
  foreach (glob($path.'/*.js') as $js) {
    $h='csd-'.md5($js); wp_enqueue_script($h, $url.'/'.basename($js), [], filemtime($js), true);
    wp_script_add_data($h,'type','module');
  }
}
add_action('wp_enqueue_scripts', function () {
  wp_enqueue_style('csd-style', get_stylesheet_uri(), [], filemtime(get_styleshee_
